<div class="card">
  <!-- World map explorer -->
  <div class="world-explore">
    <div class="world-grid">
      <app-track-world-map
        [tracks]="tracks"
        [selectedCode]="selectedCountryCode"
        (countrySelect)="onCountrySelected($event)">
      </app-track-world-map>

      <div class="country-panel" *ngIf="!selectedTrack">
        <div class="country-header" *ngIf="selectedCountryCode; else countryHint">
          <div class="country-flag" *ngIf="selectedCountryCode as code">
            <span class="flag-icon" [ngClass]="['fi', 'fi-' + code.toLowerCase()]"></span>
          </div>
          <div class="country-title">
            <h3>{{ selectedCountryName || selectedCountryCode }}</h3>
            <span class="muted">{{ countryTracks.length }} track{{ countryTracks.length > 1 ? 's' : '' }}</span>
          </div>
        </div>
        <ng-template #countryHint>
          <div class="country-empty">
            <span class="accent-color">Select a country on the map</span>
          </div>
        </ng-template>

        <div class="country-list" *ngIf="countryTracks.length">
          <button class="country-track" *ngFor="let t of countryTracks" (click)="selectTrackFromCountry(t)">
            <div class="ct-title">{{ t.display_name }}</div>
            <div class="ct-sub" *ngIf="t.location || t.country">
              <span *ngIf="t.location">{{ t.location }}</span>
              <span *ngIf="t.country"> • {{ t.country }}</span>
            </div>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="controls">
    <!----
    <div class="field span-6">
      <label for="trackSelect">Grand Prix</label>
      <select
        id="trackSelect"
        class="select select--dark border"
        [(ngModel)]="selectedKey"
        (ngModelChange)="onSelectTrack()"
      >
        <option [ngValue]="null" disabled>— Select a Track —</option>
        <option *ngFor="let track of tracks" [ngValue]="track.key">
          {{ track.country_code ? track.country_code + ' - ' : '' }}{{ track.display_name }}
        </option>
      </select>
    </div>
    -->

    <div class="field span-3" *ngIf="layoutVariants.length > 1">
      <label for="variantSelect">Layout</label>
      <select
        id="variantSelect"
        class="select select--dark border"
        [(ngModel)]="selectedVariantSignature"
        (ngModelChange)="onVariantSelect($event)"
      >
        <option *ngFor="let variant of layoutVariants" [ngValue]="variant.layout_signature">
          {{ variant.layout_label || variant.circuit_name || 'Layout' }}
        </option>
      </select>
    </div>
  </div>

  <div class="track-header" *ngIf="selectedTrack">
    <div class="flag-wrapper" *ngIf="flagClass(selectedTrack) as flagClasses">
      <span class="flag-icon" [ngClass]="flagClasses" aria-hidden="true"></span>
    </div>
    <div class="title-text">
      <h2>{{ selectedTrack.display_name }}</h2>
      <div class="subtitle">
        <span *ngIf="selectedTrack.location">{{ selectedTrack.location }}</span>
        <span *ngIf="selectedTrack.country"> • {{ selectedTrack.country }}</span>
        <span *ngIf="selectedRound"> • {{ selectedRound.year }} (Round {{ selectedRound.round }})</span>
      </div>
    </div>
  </div>

  <div class="layout-details" *ngIf="trackMap">
    <div class="layout-meta">
      <span *ngIf="trackMap.layout_length as length">Length: {{ length | number: '1.3-3' }} km</span>
      <span *ngIf="layoutYearsLabel as years">Years: {{ years }}</span>
    </div>
  </div>



  <div id="track-details-card" class="map-card" *ngIf="trackMap || loading || error" [class.map-card--loading]="loading">
    <svg class="track" id="trackMap" width="900" height="600"></svg>
    <div class="map-overlay" *ngIf="loading">Loading track …</div>
    <div class="map-overlay error" *ngIf="!loading && error">{{ error }}</div>
  </div>

  <div class="winner-list" *ngIf="displayWinners.length">
    <h3>Recent winners</h3>
    <ul>
      <li *ngFor="let winner of displayWinners" 
          [style.background-color]="getWinnerBackgroundColor(winner.team_color)"
          [style.border-left-color]="winner.team_color || 'rgba(255, 255, 255, 0.08)'">
        <span class="year">{{ winner.year }}</span>
        <div class="winner-info">
          <span class="name">{{ winner.driver || 'Unknown driver' }}</span>
          <span class="team" *ngIf="winner.team">({{ winner.team }})</span>
        </div>
      </li>
    </ul>
  </div>

</div>
  <footer class="footer">© {{ currentYear }} GridStats</footer>
